
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>DC2 Retrieve Visit-Level Forced Src Photometry and Postage Stamps from Object Catalog. &#8212; LSST DESC DC2 Analysis</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorials/object_per_visit_postage_stamp';</script>
    <link rel="canonical" href="https://lsstdesc.github.io/DC2-analysis/tutorials/object_per_visit_postage_stamp.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="DC2 object Run1.1p Apache Spark tutorial – Part I: Apache Spark access" href="object_spark_1_intro.html" />
    <link rel="prev" title="Looking at the “Object Catalogs”: merged tract-patch catalogs in DC2 Run 1.1p" href="object_pandas_stellar_locus.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../README.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="LSST DESC DC2 Analysis - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="LSST DESC DC2 Analysis - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../README.html">
                    DC2-analysis
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="README.html">DC2 Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="dia_sn_vs_truth.html">DIA Analysis: Supernovae from the Run 1.2p Test</a></li>
<li class="toctree-l1"><a class="reference internal" href="dia_source_object_stamp.html">DIA Analysis: Source, Object, and Postage Stamps for Run 1.2p Test</a></li>
<li class="toctree-l1"><a class="reference internal" href="dm_butler_lensing_cuts.html">Accessing the Coadd data using the Data Butler</a></li>
<li class="toctree-l1"><a class="reference internal" href="dm_butler_postage_stamps.html">DC2: Generate Postage Stamps for set of RA, Dec coordinates</a></li>
<li class="toctree-l1"><a class="reference internal" href="dm_butler_postage_stamps_for_object_catalogs.html">DC2: Generate Postage Stamps (Cutouts) for objects in the Object Catalog</a></li>
<li class="toctree-l1"><a class="reference internal" href="dm_butler_skymap.html">Plotting the DC2 Run2.1i skyMap</a></li>
<li class="toctree-l1"><a class="reference internal" href="extragalactic_gcr_cluster_colors.html">Plotting Galaxy Cluster Member Colors in Extragalactic Catalogs</a></li>
<li class="toctree-l1"><a class="reference internal" href="extragalactic_gcr_cluster_members.html">Plotting Positions of Galaxy Cluster Members in Extragalactic Catalogs</a></li>
<li class="toctree-l1"><a class="reference internal" href="extragalactic_gcr_hod.html">Halo Occupation Distribution from extragalactic catalogs</a></li>
<li class="toctree-l1"><a class="reference internal" href="extragalactic_gcr_mass_relations.html">Extragalactic catalogs: mass relations</a></li>
<li class="toctree-l1"><a class="reference internal" href="extragalactic_gcr_photoz_catalogs.html">cosmoDC2 extragalactic catalog photometric redshifts</a></li>

<li class="toctree-l1"><a class="reference internal" href="extragalactic_gcr_redshift_dist.html">Plot N versus z Distributions in the extragalactic catalogs</a></li>
<li class="toctree-l1"><a class="reference internal" href="matching_fof.html">Match truth and object catalogs for DC2 Run 2.2i</a></li>
<li class="toctree-l1"><a class="reference internal" href="matching_stack.html">Using the LSST Stack tools to do positional matching on coadd and src catalogs</a></li>
<li class="toctree-l1"><a class="reference internal" href="object_gcr_1_intro.html">DC2 Object Catalog Run2.2i GCR tutorial – Part I: GCR access</a></li>
<li class="toctree-l1"><a class="reference internal" href="object_gcr_2_lensing_cuts.html">DC2 Object Catalog Run2.2i GCR tutorial – Part II: Lensing Cuts</a></li>
<li class="toctree-l1"><a class="reference internal" href="object_gcr_3_challenges.html">DC2 Object Catalog Run2.2i GCR tutorial – Part III: Guided Challenges</a></li>
<li class="toctree-l1"><a class="reference internal" href="object_gcr_4_photoz.html">DC2 Object Catalog Run2.2i GCR tutorial – Part IV: accessing photo-z</a></li>
<li class="toctree-l1"><a class="reference internal" href="object_pandas_stellar_locus.html">Looking at the “Object Catalogs”: merged tract-patch catalogs in DC2 Run 1.1p</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">DC2 Retrieve Visit-Level Forced Src Photometry and Postage Stamps from Object Catalog.</a></li>

<li class="toctree-l1"><a class="reference internal" href="object_spark_1_intro.html">DC2 object Run1.1p Apache Spark tutorial – Part I: Apache Spark access</a></li>
<li class="toctree-l1"><a class="reference internal" href="postgres_forcedsource.html">Accessing DC2 forced source data in PostgreSQL at NERSC</a></li>
<li class="toctree-l1"><a class="reference internal" href="postgres_object_1_intro.html">Accessing DC2 data in PostgreSQL at NERSC</a></li>
<li class="toctree-l1"><a class="reference internal" href="postgres_object_2.html">Accessing DC2 data in PostgreSQL at NERSC part 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="postgres_truth.html">Accessing DC2 truth and simulated observations data in PostgreSQL at NERSC</a></li>
<li class="toctree-l1"><a class="reference internal" href="truth_gcr_intro.html">Accessing Truth Catalog Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="truth_gcr_variables.html">Accessing variable and transient objects in the truth catalog</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Validation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../validation/DC2_calexp_src_validation_1p2.html">Validation tests for DC2 1.2i/p single visit catalogs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../validation/README.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../validation/Run_1.2p_PSF_tests.html">Validation tests on DC2 <code class="docutils literal notranslate"><span class="pre">calexps</span></code> and <code class="docutils literal notranslate"><span class="pre">src</span></code> catalogs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../validation/validate_dc2_object_table.html">Inspection of DC2 Object Table</a></li>
<li class="toctree-l1"><a class="reference internal" href="../validation/validate_dc2_run2.1i_object_table.html">Inspection of DC2 Run 2.1i Object Table</a></li>
<li class="toctree-l1"><a class="reference internal" href="../validation/validate_dc2_run2.2i_object_table.html">Inspection of DC2 Run 2.2i DR6 Object Table</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://jupyter.nersc.gov/hub/user-redirect/git-pull?repo=https%3A//github.com/LSSTDESC/DC2-analysis&urlpath=lab/tree/DC2-analysis/tutorials/object_per_visit_postage_stamp.ipynb&branch=master" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onJupyterHub"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_jupyterhub.svg">
  </span>
<span class="btn__text-container">JupyterHub</span>
</a>
</li>
      
  </ul>
</div>



<a href="https://github.com/LSSTDESC/DC2-analysis/issues/new?title=Issue%20on%20page%20%2Ftutorials/object_per_visit_postage_stamp.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button"
   title="Open an issue"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/tutorials/object_per_visit_postage_stamp.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>DC2 Retrieve Visit-Level Forced Src Photometry and Postage Stamps from Object Catalog.</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">DC2 Retrieve Visit-Level Forced Src Photometry and Postage Stamps from Object Catalog.</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-objectives">Learning Objectives</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#see-also">See Also</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#logistics">Logistics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-a-forced-position-photometry-catalog">Reading a Forced-Position Photometry Catalog</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#finding-the-visits-that-contain-a-given-position">Finding the Visits that Contain a Given Position</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#find-the-tract-s-patch-es-for-a-given-ra-dec">Find the Tract(s), Patch(es) for a given RA, Dec</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#here-s-some-code-to-generate-postage-stamps">Here’s Some Code to Generate Postage Stamps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#finally-let-s-make-some-stamps">Finally, Let’s Make Some Stamps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#for-a-bit-of-perspective-let-s-end-by-looking-at-the-full-image">For a Bit of Perspective, let’s end by looking at the full image</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="dc2-retrieve-visit-level-forced-src-photometry-and-postage-stamps-from-object-catalog">
<h1>DC2 Retrieve Visit-Level Forced Src Photometry and Postage Stamps from Object Catalog.<a class="headerlink" href="#dc2-retrieve-visit-level-forced-src-photometry-and-postage-stamps-from-object-catalog" title="Link to this heading">#</a></h1>
<p><br>Owner: <strong>Michael Wood-Vasey</strong> (<a class="reference external" href="https://github.com/LSSTDESC/DC2-analysis/issues/new?body=&#64;wmwv">&#64;wmwv</a>)
<br>Last Verified to Run: <strong>2019-05-08</strong></p>
<section id="learning-objectives">
<h2>Learning Objectives<a class="headerlink" href="#learning-objectives" title="Link to this heading">#</a></h2>
<p>After studying this Notebook you should be able to</p>
<ol class="arabic simple">
<li><p>Retrieve the catalog of Object-position forced photometry from a given tract, patch, filter, and visit.</p></li>
<li><p>Compute the tract, patch for a given RA, Dec and skymap.</p></li>
<li><p>Retrieve a postage stamp from the per-visit calibrated image (calexp) for a given object RA, Dec.</p></li>
<li><p>Display a full coadd image and full calexp image with the location of an object highlighted.</p></li>
</ol>
</section>
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>The <a class="reference internal" href="dm_butler_postage_stamps.html"><span class="std std-doc">Coadd Postage Stamp Notebook</span></a> provides a basic introduction for getting postage stamps from the coadd image.  The actually generation of postage stamps in this present Notebook is essentially the same.  The key new things are figuring out what images to look at.</p></li>
</ol>
</section>
<section id="logistics">
<h2>Logistics<a class="headerlink" href="#logistics" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Meant to be run on NERSC, where these data and environment are available.  But beyond having an environment with the stack, the only NERSC-specific aspect is the location of the data.  If you have your own set of data elsewhere, you just need to change the <code class="docutils literal notranslate"><span class="pre">repo</span></code> below.</p></li>
<li><p>If you use <code class="docutils literal notranslate"><span class="pre">%matplotlib</span> <span class="pre">notebook</span></code> you can get interactive windows.  This works in Jupyter, but not in the full JupyterLab environment, which disallows Javascript.  To ensure something that runs in the default JupyterLab environment that we present for DESC, this Notebook uses <code class="docutils literal notranslate"><span class="pre">%matplotlib</span> <span class="pre">inline</span></code>.  But you will see <code class="docutils literal notranslate"><span class="pre">frame=2;</span> <span class="pre">plt.figure(frame)</span></code> commands that are effectively noops for <code class="docutils literal notranslate"><span class="pre">%matplotlib</span> <span class="pre">inline</span></code> but ensure that the proper frame is being referenced for the interactive windows of <code class="docutils literal notranslate"><span class="pre">%matplotlib</span> <span class="pre">notebook</span></code>.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">lsst.daf.persistence</span> <span class="k">as</span> <span class="nn">dafPersist</span>
<span class="kn">import</span> <span class="nn">lsst.afw.geom</span> <span class="k">as</span> <span class="nn">afwGeom</span>
<span class="kn">import</span> <span class="nn">lsst.afw.coord</span> <span class="k">as</span> <span class="nn">afwCoord</span>
<span class="kn">import</span> <span class="nn">lsst.afw.display</span> <span class="k">as</span> <span class="nn">afwDisplay</span>
<span class="kn">import</span> <span class="nn">lsst.afw.image</span> <span class="k">as</span> <span class="nn">afwImage</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %matplotlib notebook</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">afw_backend</span> <span class="o">=</span> <span class="s1">&#39;matplotlib&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>We use a simple repo <code class="docutils literal notranslate"><span class="pre">LSSTDESC/desc-dc2-dm-data</span></code> to track where the data repositories are actually stored.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">desc_dc2_dm_data</span> <span class="kn">import</span> <span class="n">REPOS</span>

<span class="n">run</span> <span class="o">=</span> <span class="s1">&#39;1.2p&#39;</span>
<span class="n">repo</span> <span class="o">=</span> <span class="n">REPOS</span><span class="p">[</span><span class="n">run</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">repo</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">butler</span> <span class="o">=</span> <span class="n">dafPersist</span><span class="o">.</span><span class="n">Butler</span><span class="p">(</span><span class="n">repo</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="reading-a-forced-position-photometry-catalog">
<h2>Reading a Forced-Position Photometry Catalog<a class="headerlink" href="#reading-a-forced-position-photometry-catalog" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tract</span> <span class="o">=</span> <span class="mi">4850</span>
<span class="n">patch</span> <span class="o">=</span> <span class="s1">&#39;4,5&#39;</span>

<span class="n">filt</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span>
<span class="n">partial_data_id</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tract&#39;</span><span class="p">:</span> <span class="n">tract</span><span class="p">,</span> <span class="s1">&#39;patch&#39;</span><span class="p">:</span> <span class="n">patch</span><span class="p">,</span> <span class="s1">&#39;filter&#39;</span><span class="p">:</span> <span class="n">filt</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataset_type</span> <span class="o">=</span> <span class="s1">&#39;forced_src&#39;</span>
<span class="n">data_refs</span> <span class="o">=</span> <span class="n">butler</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span><span class="n">datasetType</span><span class="o">=</span><span class="n">dataset_type</span><span class="p">,</span> <span class="n">dataId</span><span class="o">=</span><span class="n">partial_data_id</span><span class="p">)</span>
<span class="n">data_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">dr</span><span class="o">.</span><span class="n">dataId</span> <span class="k">for</span> <span class="n">dr</span> <span class="ow">in</span> <span class="n">data_refs</span>
           <span class="k">if</span> <span class="n">butler</span><span class="o">.</span><span class="n">datasetExists</span><span class="p">(</span><span class="n">datasetType</span><span class="o">=</span><span class="n">dataset_type</span><span class="p">,</span>
                                   <span class="n">dataId</span><span class="o">=</span><span class="n">dr</span><span class="o">.</span><span class="n">dataId</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<p>The following data_id should be in the list returned by the above query.  We explicitly define it here to show how to construct a data_id for the forced source photometry which requires the visit-level information (visit, filter, raftName, detectorName).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dId</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;filter&#39;</span><span class="p">:</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;visit&#39;</span><span class="p">:</span> <span class="mi">181898</span><span class="p">,</span> <span class="s1">&#39;raftName&#39;</span><span class="p">:</span> <span class="s1">&#39;R31&#39;</span><span class="p">,</span> <span class="s1">&#39;detectorName&#39;</span><span class="p">:</span> <span class="s1">&#39;S00&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>We can use this same data_id to get both the calibrated exposure (calexp) and the forced-position photometry (‘forced_src’)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">forced_src</span> <span class="o">=</span> <span class="n">butler</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">datasetType</span><span class="o">=</span><span class="s1">&#39;forced_src&#39;</span><span class="p">,</span> <span class="n">dataId</span><span class="o">=</span><span class="n">dId</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>I think in AstroPy rather than AFW Tables.  We can easily convert here with <code class="docutils literal notranslate"><span class="pre">asAstropy()</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">=</span> <span class="n">forced_src</span><span class="o">.</span><span class="n">asAstropy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">forced_src</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>The photometric calibration information is stored in the calibrated exposure.  We can extract that and use it to produce calibrated magnitudes for sources with counts &gt; 0.  Because these are forced-position photometry based on the location of obejects detected in a deeper coadd, a significant fraction of sources may have estimated counts consistent with zero and thus sometimes negative.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We also could have directly loaded the calibration information using</span>
<span class="n">calib</span> <span class="o">=</span> <span class="n">butler</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">datasetType</span><span class="o">=</span><span class="s1">&#39;calexp_calib&#39;</span><span class="p">,</span> <span class="n">dataId</span><span class="o">=</span><span class="n">dId</span><span class="p">)</span>
<span class="n">calib</span><span class="o">.</span><span class="n">setThrowOnNegativeFlux</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="n">mag</span><span class="p">,</span> <span class="n">mag_err</span> <span class="o">=</span> <span class="n">calib</span><span class="o">.</span><span class="n">getMagnitude</span><span class="p">(</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;base_PsfFlux_instFlux&#39;</span><span class="p">],</span>
                                  <span class="n">cat</span><span class="p">[</span><span class="s1">&#39;base_PsfFlux_instFluxErr&#39;</span><span class="p">])</span>
<span class="n">cat</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mag</span>
<span class="n">cat</span><span class="p">[</span><span class="s1">&#39;mag_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mag_err</span>
<span class="n">cat</span><span class="p">[</span><span class="s1">&#39;snr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;base_PsfFlux_instFlux&#39;</span><span class="p">])</span><span class="o">/</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;base_PsfFlux_instFluxErr&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">cat</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This is per tract, so ~20k sources seems potentially reasonble.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">id</span></code> is the same <code class="docutils literal notranslate"><span class="pre">id</span></code> as in the Object catalog.</p>
<p>Let’s write all of this up in a function to extract the photometry for a given object Id.  This seems trivial, but it’s worth putting in a function to put the calibration stuff all together.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_photometry_for_id</span><span class="p">(</span><span class="n">butler</span><span class="p">,</span> <span class="n">obj_id</span><span class="p">,</span> <span class="n">data_id</span><span class="p">,</span>
                          <span class="n">calibration_dataset_type</span><span class="o">=</span><span class="s1">&#39;calexp_calib&#39;</span><span class="p">,</span>
                          <span class="n">catalog_dataset_type</span><span class="o">=</span><span class="s1">&#39;forced_src&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the photometry from a data_id and datasteType for a specified object id.</span>

<span class="sd">    The motiviation is for reading out photometry from a known Object ID,</span>
<span class="sd">    such as that from an Object catalog and reading a forced-photometry catalog.</span>
<span class="sd">    But in implementation it will work fine as long as you know the Object ID</span>
<span class="sd">    in the catalog datasetType requested.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">calib</span> <span class="o">=</span> <span class="n">butler</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">datasetType</span><span class="o">=</span><span class="n">calibration_dataset_type</span><span class="p">,</span> <span class="n">dataId</span><span class="o">=</span><span class="n">data_id</span><span class="p">)</span>
    <span class="n">forced_src</span> <span class="o">=</span> <span class="n">butler</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">datasetType</span><span class="o">=</span><span class="n">catalog_dataset_type</span><span class="p">,</span> <span class="n">dataId</span><span class="o">=</span><span class="n">data_id</span><span class="p">)</span>

    <span class="n">matching_id_idx</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">forced_src</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">obj_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matching_id_idx</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Could not find obj_id: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">obj_id</span><span class="p">)</span>
        
    <span class="n">cat</span> <span class="o">=</span> <span class="n">forced_src</span><span class="o">.</span><span class="n">asAstropy</span><span class="p">()</span>
    <span class="n">calib</span><span class="o">.</span><span class="n">setThrowOnNegativeFlux</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">mag</span><span class="p">,</span> <span class="n">mag_err</span> <span class="o">=</span> <span class="n">calib</span><span class="o">.</span><span class="n">getMagnitude</span><span class="p">(</span><span class="n">forced_src</span><span class="p">[</span><span class="s1">&#39;base_PsfFlux_instFlux&#39;</span><span class="p">],</span>
                                      <span class="n">forced_src</span><span class="p">[</span><span class="s1">&#39;base_PsfFlux_instFluxErr&#39;</span><span class="p">])</span>
    <span class="n">cat</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mag</span>
    <span class="n">cat</span><span class="p">[</span><span class="s1">&#39;mag_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mag_err</span>
    <span class="n">cat</span><span class="p">[</span><span class="s1">&#39;snr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;base_PsfFlux_instFlux&#39;</span><span class="p">])</span><span class="o">/</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;base_PsfFlux_instFluxErr&#39;</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">cat</span><span class="p">[</span><span class="n">matching_id_idx</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">frame</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;coord_ra&#39;</span><span class="p">]),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;coord_dec&#39;</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;RA [deg]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Dec [deg]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">frame</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">],</span> <span class="n">cat</span><span class="p">[</span><span class="s1">&#39;snr&#39;</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> mag&#39;</span> <span class="o">%</span> <span class="n">dId</span><span class="p">[</span><span class="s1">&#39;filter&#39;</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;S/N&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">],</span> <span class="n">cat</span><span class="p">[</span><span class="s1">&#39;snr&#39;</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> mag&#39;</span> <span class="o">%</span> <span class="n">dId</span><span class="p">[</span><span class="s1">&#39;filter&#39;</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;S/N&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mf">24.25</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Looks like a reasonable set of magnitudes and uncertainties.
The left is the full distribution, while the right plot shows what happens as we go down into the noise floor.  Recall that these are the forced photometry on an individual visit based on the detections in the stacked coadd.  So we get objects that are below the detection limit in an individual image.  The noise is a property of the background, so the smooth continuation of the line even beyond a reasonable single-image limit is due to a constant noise source for a decreasing measured flux.</p>
<p>We get a 5-sigma at r=24.25 mag.  So overall on the visit we have a reasonable span of 7 magnitudes (from 17.25 to 24.25 mag).</p>
</section>
</section>
<section id="finding-the-visits-that-contain-a-given-position">
<h1>Finding the Visits that Contain a Given Position<a class="headerlink" href="#finding-the-visits-that-contain-a-given-position" title="Link to this heading">#</a></h1>
<p>Let’s pick one of the Objects and go through all of the data IDs in that filter for the tract, patch.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">good_snr</span> <span class="o">=</span> <span class="n">cat</span><span class="p">[</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;snr&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">25</span><span class="p">]</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">good_snr</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_all_images_for_object_id_from_data_ids</span><span class="p">(</span><span class="n">object_id</span><span class="p">,</span> <span class="n">data_refs</span><span class="p">,</span> <span class="n">dataset_type</span><span class="o">=</span><span class="s1">&#39;forced_src&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Take an Object ID and data_ref list and return matching data_refs that contain that object and exist</span>
<span class="sd">    </span>
<span class="sd">    Note:  This perhaps isn&#39;t quite the function you wanted.</span>
<span class="sd">    You may have wanted a function that just took an object_id and filter.</span>
<span class="sd">    But we&#39;ll get there.</span>
<span class="sd">    </span>
<span class="sd">    Note that we&#39;re being a little inefficient and loading each raft, sensor catalog</span>
<span class="sd">    and checking to see if it contains the given ID.</span>
<span class="sd">    It would likely be more efficient to just load the WCS for the Visit</span>
<span class="sd">    and look up the raft, sensor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">matching_data_refs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">data_ref</span> <span class="ow">in</span> <span class="n">data_refs</span><span class="p">:</span>
        <span class="c1"># Should add check to make sure it exists</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data_ref</span><span class="o">.</span><span class="n">datasetExists</span><span class="p">(</span><span class="n">datasetType</span><span class="o">=</span><span class="n">dataset_type</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">cat</span> <span class="o">=</span> <span class="n">data_ref</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">datasetType</span><span class="o">=</span><span class="n">dataset_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">object_id</span> <span class="ow">in</span> <span class="n">cat</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]:</span>
            <span class="n">matching_data_refs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_ref</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">matching_data_refs</span>
</pre></div>
</div>
</div>
</div>
<p>Warning: Actually running the following <code class="docutils literal notranslate"><span class="pre">get_all_images_for_object_id_from_data_ids</span></code> can take a long time - somehwere between 30 minutes and never.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">matching_data_refs</span> <span class="o">=</span> <span class="n">get_all_images_for_object_id_from_data_ids</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">data_refs</span><span class="p">,</span> <span class="n">dataset_type</span><span class="o">=</span><span class="s1">&#39;forced_src&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">dr</span><span class="o">.</span><span class="n">dataId</span> <span class="k">for</span> <span class="n">dr</span> <span class="ow">in</span> <span class="n">matching_data_refs</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data_ids</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="find-the-tract-s-patch-es-for-a-given-ra-dec">
<h2>Find the Tract(s), Patch(es) for a given RA, Dec<a class="headerlink" href="#find-the-tract-s-patch-es-for-a-given-ra-dec" title="Link to this heading">#</a></h2>
<p>We’re still missing one step.</p>
<p>How do we get the tract, patch for a given ObjectId or RA, Dec?</p>
<p>You probably wanted to start with a given ObjectID from the Object (coadd) catalog and then get all of the images that include that object.</p>
<p>To do this we</p>
<ol class="arabic simple">
<li><p>Get the skymap for the coadd dataset (by default, <code class="docutils literal notranslate"><span class="pre">deepCoadd</span></code>)</p></li>
<li><p>Use the skymap object to look up the tract</p></li>
<li><p>Use the tract object to look up the patch</p></li>
<li><p>Create a partial data Id dict and query the butler for <code class="docutils literal notranslate"><span class="pre">forced_src</span></code> catalogs that match this partial data Id.</p></li>
<li><p>Go through each forced_src catalog in that tract, patch and save the ones that match the given Id.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">skymap</span> <span class="o">=</span> <span class="n">butler</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">datasetType</span><span class="o">=</span><span class="s1">&#39;deepCoadd_skyMap&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">skymap</span><span class="o">.</span><span class="n">findTractPatchList</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;coord_ra&#39;</span><span class="p">],</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;coord_dec&#39;</span><span class="p">]</span>
<span class="c1"># Note the catalog returns coord_ra, coord_dec in RADIANS</span>
<span class="n">radec</span> <span class="o">=</span> <span class="n">afwGeom</span><span class="o">.</span><span class="n">SpherePoint</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">afwGeom</span><span class="o">.</span><span class="n">radians</span><span class="p">)</span>

<span class="n">tracts_and_patches</span> <span class="o">=</span> <span class="n">skymap</span><span class="o">.</span><span class="n">findTractPatchList</span><span class="p">([</span><span class="n">radec</span><span class="p">])</span>

<span class="n">partial_data_ids</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;tract&#39;</span><span class="p">:</span> <span class="n">tractInfo</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="s1">&#39;patch&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">,</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">patch</span><span class="o">.</span><span class="n">getIndex</span><span class="p">()}</span> \
                    <span class="k">for</span> <span class="n">tractInfo</span><span class="p">,</span> <span class="n">patchList</span> <span class="ow">in</span> <span class="n">tracts_and_patches</span>
                    <span class="k">for</span> <span class="n">patch</span> <span class="ow">in</span> <span class="n">patchList</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filt</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span>
<span class="n">dataset_type</span> <span class="o">=</span> <span class="s1">&#39;forced_src&#39;</span>

<span class="n">data_refs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">partial</span> <span class="ow">in</span> <span class="n">partial_data_ids</span><span class="p">:</span>
    <span class="n">this_data_id</span> <span class="o">=</span> <span class="n">partial</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">this_data_id</span><span class="p">[</span><span class="s1">&#39;filter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">this_data_id</span><span class="p">)</span>
    
    <span class="n">these_data_refs</span> <span class="o">=</span> <span class="n">butler</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span><span class="n">datasetType</span><span class="o">=</span><span class="n">dataset_type</span><span class="p">,</span> <span class="n">dataId</span><span class="o">=</span><span class="n">this_data_id</span><span class="p">)</span>
    <span class="n">data_refs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">these_data_refs</span><span class="p">)</span>

<span class="n">data_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">dr</span><span class="o">.</span><span class="n">dataId</span> <span class="k">for</span> <span class="n">dr</span> <span class="ow">in</span> <span class="n">data_refs</span>
           <span class="k">if</span> <span class="n">butler</span><span class="o">.</span><span class="n">datasetExists</span><span class="p">(</span><span class="n">datasetType</span><span class="o">=</span><span class="n">dataset_type</span><span class="p">,</span>
                                   <span class="n">dataId</span><span class="o">=</span><span class="n">dr</span><span class="o">.</span><span class="n">dataId</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">matching_data_refs</span> <span class="o">=</span> <span class="n">get_all_images_for_object_id_from_data_ids</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">data_refs</span><span class="p">,</span> <span class="n">dataset_type</span><span class="o">=</span><span class="s1">&#39;forced_src&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">dr</span><span class="o">.</span><span class="n">dataId</span> <span class="k">for</span> <span class="n">dr</span> <span class="ow">in</span> <span class="n">matching_data_refs</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">data_ids</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="here-s-some-code-to-generate-postage-stamps">
<h2>Here’s Some Code to Generate Postage Stamps<a class="headerlink" href="#here-s-some-code-to-generate-postage-stamps" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">cutout_ra_dec</span><span class="p">(</span><span class="n">butler</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">data_id</span><span class="p">,</span> <span class="n">datasetType</span><span class="o">=</span><span class="s1">&#39;calexp&#39;</span><span class="p">,</span>
                  <span class="n">cutoutSideLength</span><span class="o">=</span><span class="mi">51</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Produce a cutout from the given image at the given afw SpherePoint radec position.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    butler: lsst.daf.persistence.Butler</span>
<span class="sd">        Servant providing access to a data repository</span>
<span class="sd">    ra, dec: Right Ascension, Declination in decimal degrees</span>
<span class="sd">        Coordinates of the center of the cutout.</span>
<span class="sd">    data_id: Data Id</span>
<span class="sd">    datasetType: string [&#39;calexp&#39;]  </span>
<span class="sd">    cutoutSideLength: float [optional] </span>
<span class="sd">        Side of the cutout region in pixels.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    MaskedImage</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cutoutSize</span> <span class="o">=</span> <span class="n">afwGeom</span><span class="o">.</span><span class="n">ExtentI</span><span class="p">(</span><span class="n">cutoutSideLength</span><span class="p">,</span> <span class="n">cutoutSideLength</span><span class="p">)</span>

    <span class="n">radec</span> <span class="o">=</span> <span class="n">afwGeom</span><span class="o">.</span><span class="n">SpherePoint</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">afwGeom</span><span class="o">.</span><span class="n">degrees</span><span class="p">)</span>

    <span class="n">calexp</span> <span class="o">=</span> <span class="n">butler</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">datasetType</span><span class="p">,</span> <span class="n">dataId</span><span class="o">=</span><span class="n">data_id</span><span class="p">)</span>
    <span class="n">xy</span> <span class="o">=</span> <span class="n">afwGeom</span><span class="o">.</span><span class="n">PointI</span><span class="p">(</span><span class="n">calexp</span><span class="o">.</span><span class="n">getWcs</span><span class="p">()</span><span class="o">.</span><span class="n">skyToPixel</span><span class="p">(</span><span class="n">radec</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Making cutout at (x, y) </span><span class="si">{xy:}</span><span class="s2"> of size (</span><span class="si">{cutoutSize:}</span><span class="s2">, </span><span class="si">{cutoutSize:}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">({</span><span class="s1">&#39;xy&#39;</span><span class="p">:</span> <span class="n">xy</span><span class="p">,</span> <span class="s1">&#39;cutoutSize&#39;</span><span class="p">:</span> <span class="n">cutoutSize</span><span class="p">}))</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">cutoutSize</span><span class="p">)</span>

    <span class="n">bbox</span> <span class="o">=</span> <span class="n">afwGeom</span><span class="o">.</span><span class="n">BoxI</span><span class="p">(</span><span class="n">xy</span> <span class="o">-</span> <span class="n">cutoutSize</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">cutoutSize</span><span class="p">)</span>
    
    <span class="n">cutout_image</span> <span class="o">=</span> <span class="n">butler</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">datasetType</span><span class="o">+</span><span class="s1">&#39;_sub&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">bbox</span><span class="p">,</span> <span class="n">immediate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dataId</span><span class="o">=</span><span class="n">data_id</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">cutout_image</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">display_cutout_image</span><span class="p">(</span><span class="n">butler</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">data_id</span><span class="p">,</span>
                         <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">frame</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="s1">&#39;matplotlib&#39;</span><span class="p">,</span>
                         <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">saveplot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">savefits</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                         <span class="n">datasetType</span><span class="o">=</span><span class="s1">&#39;calexp&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Display a postage stamp for a given RA, Dec using LSST lsst.afw.display.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ra: float [degrees]</span>
<span class="sd">    dec: float [degrees]</span>
<span class="sd">    backend: string</span>
<span class="sd">        Backend can be anything that lsst.afw.display and your configuration supports: </span>
<span class="sd">        e.g. matplotlib, ds9, ginga, firefly.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    MaskedImage</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Parameters are the same as for make_cutout_image, except for the backend.</span>
<span class="sd">    You can rely on definitely having the matplotlib backend.</span>
<span class="sd">    ds9, ginga, and firefly can be set up but are non-trivial on the scale of a simple Notebook.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cutout_image</span> <span class="o">=</span> <span class="n">cutout_ra_dec</span><span class="p">(</span><span class="n">butler</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">data_id</span><span class="p">,</span> <span class="n">datasetType</span><span class="o">=</span><span class="s1">&#39;deepCoadd&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">savefits</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">savefits</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">savefits</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;postage-stamp.fits&#39;</span>
        <span class="n">cutout_image</span><span class="o">.</span><span class="n">writeFits</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">display</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">display</span> <span class="o">=</span> <span class="n">afwDisplay</span><span class="o">.</span><span class="n">Display</span><span class="p">(</span><span class="n">frame</span><span class="o">=</span><span class="n">frame</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">)</span>

    <span class="n">radec</span> <span class="o">=</span> <span class="n">afwGeom</span><span class="o">.</span><span class="n">SpherePoint</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">afwGeom</span><span class="o">.</span><span class="n">degrees</span><span class="p">)</span>
    <span class="n">xy</span> <span class="o">=</span> <span class="n">cutout_image</span><span class="o">.</span><span class="n">getWcs</span><span class="p">()</span><span class="o">.</span><span class="n">skyToPixel</span><span class="p">(</span><span class="n">radec</span><span class="p">)</span>
    
    <span class="n">display</span><span class="o">.</span><span class="n">mtv</span><span class="p">(</span><span class="n">cutout_image</span><span class="p">)</span>
    <span class="n">display</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="s2">&quot;asinh&quot;</span><span class="p">,</span> <span class="s2">&quot;zscale&quot;</span><span class="p">)</span>
    <span class="n">display</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">.</span><span class="n">getX</span><span class="p">(),</span> <span class="n">xy</span><span class="o">.</span><span class="n">getY</span><span class="p">(),</span> <span class="n">ctype</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
    <span class="n">display</span><span class="o">.</span><span class="n">show_colorbar</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">cutout_image</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="finally-let-s-make-some-stamps">
<h2>Finally, Let’s Make Some Stamps<a class="headerlink" href="#finally-let-s-make-some-stamps" title="Link to this heading">#</a></h2>
<p>We can now use these data_ids to</p>
<ol class="arabic simple">
<li><p>Generate postage stamps from the calexps</p></li>
<li><p>Extract the photometry from the forced-source catalog by matching to Object Id.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">frame</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

<span class="n">ra</span><span class="p">,</span> <span class="n">deg</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;coord_ra&#39;</span><span class="p">],</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;coord_dec&#39;</span><span class="p">]</span>
<span class="n">ra_deg</span><span class="p">,</span> <span class="n">dec_deg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">ra</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span>

<span class="k">for</span> <span class="n">did</span> <span class="ow">in</span> <span class="n">data_ids</span><span class="p">:</span>
    <span class="n">cutout</span> <span class="o">=</span> <span class="n">display_cutout_image</span><span class="p">(</span><span class="n">butler</span><span class="p">,</span> <span class="n">ra_deg</span><span class="p">,</span> <span class="n">dec_deg</span><span class="p">,</span> <span class="n">did</span><span class="p">,</span> <span class="n">datasetType</span><span class="o">=</span><span class="s1">&#39;calexp&#39;</span><span class="p">,</span>
                                 <span class="n">frame</span><span class="o">=</span><span class="n">frame</span><span class="p">)</span>
    <span class="n">phot</span> <span class="o">=</span> <span class="n">get_photometry_for_id</span><span class="p">(</span><span class="n">butler</span><span class="p">,</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">did</span><span class="p">,</span>
                                 <span class="n">catalog_dataset_type</span><span class="o">=</span><span class="s1">&#39;forced_src&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">phot</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;coord_ra&#39;</span><span class="p">,</span> <span class="s1">&#39;coord_dec&#39;</span><span class="p">,</span> <span class="s1">&#39;mag&#39;</span><span class="p">,</span> <span class="s1">&#39;mag_err&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">maskName</span><span class="p">,</span> <span class="n">maskBit</span> <span class="ow">in</span> <span class="n">cutout</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">getMaskPlaneDict</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">maskName</span><span class="p">,</span> <span class="n">display</span><span class="o">.</span><span class="n">getMaskPlaneColor</span><span class="p">(</span><span class="n">maskName</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="for-a-bit-of-perspective-let-s-end-by-looking-at-the-full-image">
<h2>For a Bit of Perspective, let’s end by looking at the full image<a class="headerlink" href="#for-a-bit-of-perspective-let-s-end-by-looking-at-the-full-image" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">did</span> <span class="o">=</span> <span class="n">data_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">coadd</span> <span class="o">=</span> <span class="n">butler</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;deepCoadd&#39;</span><span class="p">,</span> <span class="n">dataId</span><span class="o">=</span><span class="n">did</span><span class="p">)</span>
<span class="n">calexp</span> <span class="o">=</span> <span class="n">butler</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;calexp&#39;</span><span class="p">,</span> <span class="n">dataId</span><span class="o">=</span><span class="n">did</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">frame</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

<span class="n">xy</span> <span class="o">=</span> <span class="n">coadd</span><span class="o">.</span><span class="n">getWcs</span><span class="p">()</span><span class="o">.</span><span class="n">skyToPixel</span><span class="p">(</span><span class="n">radec</span><span class="p">)</span>

<span class="n">display</span> <span class="o">=</span> <span class="n">afwDisplay</span><span class="o">.</span><span class="n">Display</span><span class="p">(</span><span class="n">frame</span><span class="o">=</span><span class="n">frame</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">afw_backend</span><span class="p">)</span>
<span class="n">display</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="s2">&quot;asinh&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="n">display</span><span class="o">.</span><span class="n">mtv</span><span class="p">(</span><span class="n">coadd</span><span class="p">)</span>
<span class="n">display</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">.</span><span class="n">getX</span><span class="p">(),</span> <span class="n">xy</span><span class="o">.</span><span class="n">getY</span><span class="p">(),</span> <span class="n">ctype</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Note the outlines above showing the pattern of the chip gaps in the visit images that went into the coadd (green), saturated spikes from bright stars (also green), and the identified objects (blue).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">frame</span> <span class="o">=</span> <span class="mi">5</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

<span class="n">xy</span> <span class="o">=</span> <span class="n">calexp</span><span class="o">.</span><span class="n">getWcs</span><span class="p">()</span><span class="o">.</span><span class="n">skyToPixel</span><span class="p">(</span><span class="n">radec</span><span class="p">)</span>

<span class="n">display</span> <span class="o">=</span> <span class="n">afwDisplay</span><span class="o">.</span><span class="n">Display</span><span class="p">(</span><span class="n">frame</span><span class="o">=</span><span class="n">frame</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">afw_backend</span><span class="p">)</span>
<span class="n">display</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="s2">&quot;asinh&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">display</span><span class="o">.</span><span class="n">mtv</span><span class="p">(</span><span class="n">calexp</span><span class="p">)</span>
<span class="n">display</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">.</span><span class="n">getX</span><span class="p">(),</span> <span class="n">xy</span><span class="o">.</span><span class="n">getY</span><span class="p">(),</span> <span class="n">ctype</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "desc-stack"
        },
        kernelOptions: {
            name: "desc-stack",
            path: "./tutorials"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'desc-stack'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="object_pandas_stellar_locus.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Looking at the “Object Catalogs”: merged tract-patch catalogs in DC2 Run 1.1p</p>
      </div>
    </a>
    <a class="right-next"
       href="object_spark_1_intro.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">DC2 object Run1.1p Apache Spark tutorial – Part I: Apache Spark access</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">DC2 Retrieve Visit-Level Forced Src Photometry and Postage Stamps from Object Catalog.</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-objectives">Learning Objectives</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#see-also">See Also</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#logistics">Logistics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-a-forced-position-photometry-catalog">Reading a Forced-Position Photometry Catalog</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#finding-the-visits-that-contain-a-given-position">Finding the Visits that Contain a Given Position</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#find-the-tract-s-patch-es-for-a-given-ra-dec">Find the Tract(s), Patch(es) for a given RA, Dec</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#here-s-some-code-to-generate-postage-stamps">Here’s Some Code to Generate Postage Stamps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#finally-let-s-make-some-stamps">Finally, Let’s Make Some Stamps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#for-a-bit-of-perspective-let-s-end-by-looking-at-the-full-image">For a Bit of Perspective, let’s end by looking at the full image</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By LSST DESC
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>